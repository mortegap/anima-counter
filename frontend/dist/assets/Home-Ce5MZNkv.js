import{j as N,u as y,k as _,h as S,l as I,_ as k,c as m,a as n,b as D,t as f,e as P,o as h,m as V,d as v,v as z,n as G,p as K,q as H,s as j,w as O,F as B,x as U,f as A,r as $,y as W,i as J}from"./index-D_RMLl0f.js";const R=N("gameState",{state:()=>({turn_number:0,zeon:0,rzeon:0,act:0,rzeoni:0,zeona:0,zeonp:0,acu:!1,lock:0,zeonToSpend:0,mantainZeonToSpend:0,spellBook:[],readyToCast:[],spellMantainList:[],loading:!1,error:null}),getters:{totalZeonAccumulated:t=>t.zeona+t.zeonp,availableZeon:t=>t.rzeon+t.zeona+t.zeonp-t.zeonToSpend-t.mantainZeonToSpend,totalReadyToCast:t=>t.readyToCast.length,totalMantained:t=>t.spellMantainList.length},actions:{async loadGameData(){var e,l,a;const t=y();if(!((e=t.profile)!=null&&e.id)){console.error("No hay perfil cargado");return}try{this.loading=!0,this.error=null;const s=await _.get(`/api/gamestate/${t.profile.id}`);this.updateLocalGameState(s.data);const p=await _.get(`/api/spells/${t.profile.id}`);this.spellBook=p.data;const o=await _.get(`/api/ready-to-cast/${t.profile.id}`);this.readyToCast=o.data,this.updateZeonToSpend(),console.log("🔍 Cargando spell mantain list para perfil:",t.profile.id);const d=await _.get(`/api/spell-mantain/${t.profile.id}`);console.log("📦 Respuesta spell mantain:",d.data),this.spellMantainList=d.data,this.updateMantainZeonToSpend()}catch(s){console.error("Error cargando datos del juego:",s),this.error=((a=(l=s.response)==null?void 0:l.data)==null?void 0:a.error)||"Error al cargar los datos del juego"}finally{this.loading=!1}},updateLocalGameState(t){this.turn_number=t.turn_number??0,this.zeon=t.zeon??0,this.rzeon=t.rzeon??0,this.act=t.act??0,this.rzeoni=t.rzeoni??0,this.zeona=t.zeona??0,this.zeonp=t.zeonp??0,this.acu=t.acu??!1,this.lock=t.lock_state??0,this.zeonToSpend=t.zeon_to_spend??0,this.mantainZeonToSpend=t.mantain_zeon_to_spend??0},async saveGameState(){var e,l,a;const t=y();if((e=t.profile)!=null&&e.id)try{await _.put(`/api/gamestate/${t.profile.id}`,{turn_number:this.turn_number,zeon:this.zeon,rzeon:this.rzeon,act:this.act,rzeoni:this.rzeoni,zeona:this.zeona,zeonp:this.zeonp,acu:this.acu,lock_state:this.lock,zeon_to_spend:this.zeonToSpend,mantain_zeon_to_spend:this.mantainZeonToSpend})}catch(s){console.error("Error guardando estado del juego:",s),this.error=((a=(l=s.response)==null?void 0:l.data)==null?void 0:a.error)||"Error al guardar el estado"}},async nextTurn(){if(console.log("🔄 nextTurn() llamado"),console.log("📊 Valores antes:",{turn_number:this.turn_number,rzeon:this.rzeon,mantainZeonToSpend:this.mantainZeonToSpend,spellMantainList:this.spellMantainList}),this.turn_number++,this.acu&&this.act>0&&(this.zeona+=this.act),this.mantainZeonToSpend>0){const t=this.rzeon;this.rzeon=Math.max(this.rzeon-this.mantainZeonToSpend,0),console.log(`✅ Zeon de mantenimiento restado: ${t} - ${this.mantainZeonToSpend} = ${this.rzeon}`)}else console.log("⚠️ mantainZeonToSpend es 0 o undefined");console.log("📊 Valores después:",{turn_number:this.turn_number,rzeon:this.rzeon}),await this.saveGameState()},async previousTurn(){this.turn_number>0&&(this.turn_number--,this.acu&&this.act>0&&(this.zeona=Math.max(this.zeona-this.act,0)),this.mantainZeonToSpend>0&&(this.rzeon=Math.min(this.rzeon+this.mantainZeonToSpend,this.zeon)),await this.saveGameState())},async newDay(){const t=this.rzeon+this.rzeoni;this.rzeon=Math.min(t,this.zeon),await this.saveGameState()},updateZeonToSpend(){this.zeonToSpend=this.readyToCast.reduce((t,e)=>t+(e.spell_zeon||e.zeon_cost||0),0)},updateMantainZeonToSpend(){console.log("🔍 updateMantainZeonToSpend() llamado"),console.log("📋 spellMantainList:",this.spellMantainList),this.mantainZeonToSpend=this.spellMantainList.reduce((t,e)=>{const l=e.spell_mantain||e.mantain_cost||0;return console.log(`  - Hechizo: ${e.spell_name}, mantain: ${l}`),t+l},0),console.log("✅ Total mantainZeonToSpend:",this.mantainZeonToSpend)},async addZeonAccumulated(t,e="normal"){e==="normal"?this.zeona+=t:this.zeonp+=t,await this.saveGameState()},async spendZeon(t){this.rzeon=Math.max(0,this.rzeon-t),await this.saveGameState()},async addZeon(t){this.rzeon=Math.min(this.rzeon+t,this.zeon),await this.saveGameState()},async updateCharacteristics(t){Object.assign(this,t),await this.saveGameState()},async addSpell(t){const e=y();try{const l=await _.post(`/api/spells/${e.profile.id}`,t);this.spellBook.push(l.data)}catch(l){throw console.error("Error añadiendo hechizo:",l),l}},async deleteSpell(t){const e=y();try{await _.delete(`/api/spells/${e.profile.id}/${t}`),this.spellBook=this.spellBook.filter(l=>l.id!==t)}catch(l){throw console.error("Error eliminando hechizo:",l),l}},async addToReadyToCast(t){const e=y();try{console.log("🔍 addToReadyToCast - spellData recibido:",t);const l=await _.post(`/api/ready-to-cast/${e.profile.id}`,t);console.log("✅ Respuesta del backend:",l.data),this.readyToCast.push(l.data),this.updateZeonToSpend()}catch(l){throw console.error("Error añadiendo hechizo a lanzar:",l),l}},async removeFromReadyToCast(t){const e=y();try{await _.delete(`/api/ready-to-cast/${e.profile.id}/${t}`),this.readyToCast=this.readyToCast.filter(l=>l.id!==t),this.updateZeonToSpend()}catch(l){throw console.error("Error eliminando hechizo a lanzar:",l),l}},async addToMantain(t){const e=y();try{const l=await _.post(`/api/spell-mantain/${e.profile.id}`,{spell_id:t.id,mantain_cost:t.mantain_cost});this.spellMantainList.push(l.data),this.updateMantainZeonToSpend()}catch(l){throw console.error("Error añadiendo hechizo a mantener:",l),l}},async removeFromMantain(t){const e=y();try{await _.delete(`/api/spell-mantain/${e.profile.id}/${t}`),this.spellMantainList=this.spellMantainList.filter(l=>l.id!==t),this.updateMantainZeonToSpend()}catch(l){throw console.error("Error eliminando hechizo mantenido:",l),l}},async clearAllReadyToCast(){const t=y();try{await _.delete(`/api/ready-to-cast/${t.profile.id}`),this.readyToCast=[],this.updateZeonToSpend()}catch(e){throw console.error("Error limpiando hechizos a lanzar:",e),e}},async clearAllMantain(){const t=y();try{await _.delete(`/api/spell-mantain/${t.profile.id}`),this.spellMantainList=[],this.updateMantainZeonToSpend()}catch(e){throw console.error("Error limpiando hechizos mantenidos:",e),e}},resetState(){this.turn_number=0,this.zeon=0,this.rzeon=0,this.act=0,this.rzeoni=0,this.zeona=0,this.zeonp=0,this.acu=!1,this.lock=0,this.zeonToSpend=0,this.mantainZeonToSpend=0,this.spellBook=[],this.readyToCast=[],this.spellMantainList=[],this.loading=!1,this.error=null}}}),L=N("spells",()=>{const t=S([]),e=S([]),l=S([]),a=I(()=>e.value.reduce((c,r)=>c+parseInt(r.spellZeon||0),0)),s=I(()=>l.value.reduce((c,r)=>c+parseInt(r.spellMantain||r.spell_mantain||0),0));async function p(){const c=y();if(c.currentProfileId)try{const r=await _.get(`/api/spells/${c.currentProfileId}`);t.value=r.data}catch(r){throw console.error("Error fetching spell book:",r),r}}async function o(c){const r=y();if(!r.currentProfileId)throw new Error("No hay perfil seleccionado. Por favor, inicia sesión de nuevo.");try{const i=await _.post(`/api/spells/${r.currentProfileId}`,c);t.value.push(i.data)}catch(i){throw console.error("Error adding spell:",i),i}}async function d(c){const r=y();if(r.currentProfileId)try{const i=t.value.find(u=>u.spell_name===c);if(i){await _.delete(`/api/spells/${r.currentProfileId}/${i.id}`);const u=t.value.findIndex(b=>b.spell_name===c);u!==-1&&t.value.splice(u,1)}}catch(i){throw console.error("Error removing spell:",i),i}}async function T(){const c=y();if(c.currentProfileId)try{const r=await _.get(`/api/ready-to-cast/${c.currentProfileId}`);e.value=r.data.map((i,u)=>({id:i.id,spellIndex:u,spellName:i.spell_name,spellZeon:i.spell_zeon,spellMantain:i.spell_mantain||0,spellMantainTurn:i.spell_mantain_turn||!1,spell_id:i.spell_id}))}catch(r){throw console.error("Error fetching ready to cast:",r),r}}async function C(c,r,i=0){const u=y();if(u.currentProfileId)try{const b=t.value.find(w=>w.spell_name===c),Z=await _.post(`/api/ready-to-cast/${u.currentProfileId}`,{spell_id:b?b.id:null,spell_name:c,spell_zeon:r,spell_mantain:i||0,spell_index:e.value.length});e.value.push({id:Z.data.id,spellIndex:e.value.length,spellName:c,spellZeon:r,spellMantain:i,spellMantainTurn:!1,spell_id:b?b.id:null})}catch(b){throw console.error("Error loading spell:",b),b}}async function x(c,r){const i=y();if(i.currentProfileId)try{const u=e.value.find(b=>b.spellIndex===c);if(u){await _.delete(`/api/ready-to-cast/${i.currentProfileId}/${u.id}`);const b=e.value.findIndex(Z=>Z.spellIndex===c);b!==-1&&e.value.splice(b,1)}}catch(u){throw console.error("Error unloading spell:",u),u}}async function E(){const c=y();if(c.currentProfileId)try{const r=await _.get(`/api/spell-mantain/${c.currentProfileId}`);l.value=r.data.map((i,u)=>({id:i.id,spell_index:u,spell_name:i.spell_name,spell_mantain:i.spell_mantain,spell_id:i.spell_id}))}catch(r){throw console.error("Error fetching maintained spells:",r),r}}async function g(c){const r=y();if(r.currentProfileId)try{const i=l.value.find(u=>u.spell_index===c);if(i){await _.delete(`/api/spell-mantain/${r.currentProfileId}/${i.id}`);const u=l.value.findIndex(b=>b.spell_index===c);u!==-1&&l.value.splice(u,1)}}catch(i){throw console.error("Error unmantaining spell:",i),i}}async function M(){const c=y(),r=R();if(c.currentProfileId)try{const i=e.value.filter(w=>w.spellMantainTurn===!0);for(const w of i){const q=await _.post(`/api/spell-mantain/${c.currentProfileId}`,{spell_id:w.spell_id,spell_name:w.spellName,spell_mantain:w.spellMantain,spell_index:l.value.length});l.value.push({id:q.data.id,spell_index:l.value.length,spell_name:w.spellName,spell_mantain:w.spellMantain,spell_id:w.spell_id})}let u=parseInt(r.zeona)-parseInt(a.value),b=parseInt(r.rzeon),Z=parseInt(r.zeonp);u>=10?(b=b+(u-10),Z=Z+10,u=0):(b=b+u,u=0),r.zeona=u,r.rzeon=b,r.zeonp=Z,await _.delete(`/api/ready-to-cast/${c.currentProfileId}`),e.value=[],await r.saveGameState()}catch(i){throw console.error("Error casting spell:",i),i}}function F(){t.value=[],e.value=[],l.value=[]}return{spellBook:t,readyToCast:e,spellMantainList:l,zeonToSpend:a,mantainZeonToSpend:s,fetchSpellBook:p,addSpell:o,removeSpell:d,fetchReadyToCast:T,loadSpell:C,unloadSpell:x,fetchMaintainedSpells:E,unmantainSpell:g,castSpell:M,resetSpellData:F}}),Q={name:"TurnCounter",setup(){const t=R();return{gameState:t,nextTurn:async()=>{await t.nextTurn()},previousTurn:async()=>{await t.previousTurn()},newDay:async()=>{await t.newDay()}}}},X={class:"card mb-3"},Y={class:"card-body text-center"},ee={class:"d-flex justify-content-center align-items-center gap-3"},ne=["disabled"],ae={class:"turn-display"},te={class:"mb-0"},oe={class:"mt-3"},le={key:0,class:"mt-3 text-muted small"};function se(t,e,l,a,s,p){return h(),m("div",X,[n("div",Y,[e[7]||(e[7]=n("h6",{class:"text-muted mb-3"},"Turno",-1)),n("div",ee,[n("button",{class:"btn btn-outline-secondary",onClick:e[0]||(e[0]=(...o)=>a.previousTurn&&a.previousTurn(...o)),disabled:a.gameState.turn_number===0},[...e[3]||(e[3]=[n("i",{class:"bi bi-arrow-left"},null,-1)])],8,ne),n("div",ae,[n("h1",te,f(a.gameState.turn_number),1)]),n("button",{class:"btn btn-outline-primary",onClick:e[1]||(e[1]=(...o)=>a.nextTurn&&a.nextTurn(...o))},[...e[4]||(e[4]=[n("i",{class:"bi bi-arrow-right"},null,-1)])])]),n("div",oe,[n("button",{class:"btn btn-outline-success btn-sm",onClick:e[2]||(e[2]=(...o)=>a.newDay&&a.newDay(...o))},[...e[5]||(e[5]=[n("i",{class:"bi bi-sunrise"},null,-1),P(" +1 día ",-1)])])]),a.gameState.rzeoni>0?(h(),m("div",le,[e[6]||(e[6]=n("i",{class:"bi bi-arrow-repeat"},null,-1)),P(" Regeneración: +"+f(a.gameState.rzeoni)+" zeon por día ",1)])):D("",!0)])])}const re=k(Q,[["render",se],["__scopeId","data-v-3aaf3de5"]]),ie={name:"CharacterStats",setup(){const t=R(),e=S(!1),l=S(t.rzeon),a=S(t.act),s=S(t.rzeoni),p=S(t.zeon);V(()=>t.rzeon,C=>{l.value=C});const o=()=>{l.value=t.rzeon,a.value=t.act,s.value=t.rzeoni,p.value=t.zeon};return{gameState:t,isEditing:e,localRzeon:l,localAct:a,localRzeoni:s,localZeon:p,toggleEdit:async()=>{e.value?await t.updateCharacteristics({zeon:p.value,act:a.value,rzeoni:s.value}):o(),e.value=!e.value},updateRzeon:async()=>{l.value>=0&&l.value!==t.rzeon&&await t.updateCharacteristics({rzeon:l.value})}}}},de={class:"card mb-3"},ce={class:"card-header d-flex justify-content-between align-items-center"},ue={class:"card-body"},pe={class:"row g-3"},me={class:"col-md-6"},he=["disabled"],_e={class:"col-md-6"},fe=["disabled"],be={class:"col-md-6"},ve=["disabled"],ye={class:"col-md-6"};function ze(t,e,l,a,s,p){return h(),m("div",de,[n("div",ce,[e[7]||(e[7]=n("h5",{class:"mb-0"},"Características",-1)),n("button",{class:"btn btn-sm btn-outline-primary",onClick:e[0]||(e[0]=(...o)=>a.toggleEdit&&a.toggleEdit(...o))},f(a.isEditing?"Guardar":"Editar"),1)]),n("div",ue,[n("div",pe,[n("div",me,[e[8]||(e[8]=n("label",{for:"char-stats-rzeon",class:"form-label"},"Zeon Máximo",-1)),v(n("input",{id:"char-stats-rzeon",type:"number",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=o=>a.localZeon=o),disabled:!a.isEditing,min:"0"},null,8,he),[[z,a.localZeon,void 0,{number:!0}]])]),n("div",_e,[e[9]||(e[9]=n("label",{for:"char-stats-act",class:"form-label"},"ACT",-1)),v(n("input",{id:"char-stats-act",type:"number",class:"form-control","onUpdate:modelValue":e[2]||(e[2]=o=>a.localAct=o),disabled:!a.isEditing,min:"0"},null,8,fe),[[z,a.localAct,void 0,{number:!0}]])]),n("div",be,[e[10]||(e[10]=n("label",{for:"char-stats-rzeoni",class:"form-label"},"Regeneración Zeónica",-1)),v(n("input",{id:"char-stats-rzeoni",type:"number",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=o=>a.localRzeoni=o),disabled:!a.isEditing,min:"0"},null,8,ve),[[z,a.localRzeoni,void 0,{number:!0}]])]),n("div",ye,[e[11]||(e[11]=n("label",{for:"char-stats-zeon-actual",class:"form-label"},"Reserva de Zeon",-1)),v(n("input",{id:"char-stats-zeon-actual",type:"number",class:"form-control","onUpdate:modelValue":e[4]||(e[4]=o=>a.localRzeon=o),onBlur:e[5]||(e[5]=(...o)=>a.updateRzeon&&a.updateRzeon(...o)),onKeyup:e[6]||(e[6]=G((...o)=>a.updateRzeon&&a.updateRzeon(...o),["enter"])),min:"0"},null,544),[[z,a.localRzeon,void 0,{number:!0}]])])])])])}const ge=k(ie,[["render",ze],["__scopeId","data-v-66b8ab75"]]),Se={name:"ZeonControl",setup(){const t=R(),e=S(1),l=S(0),a=S(t.zeon),s=S(t.acu);V(()=>t.zeon,g=>{a.value=g}),V(()=>t.acu,g=>{s.value=g});const p=I(()=>t.zeon===0?0:Math.min(100,t.rzeon/t.zeon*100)),o=I(()=>{const g=p.value;return g<25?"bg-danger":g<50?"bg-warning":g<75?"bg-info":"bg-success"}),d=I(()=>t.availableZeon<0?"text-danger":"text-success");return{gameState:t,rzeonAmount:e,maxZeon:a,acuCheckbox:s,zeonLostAmount:l,zeonPercentage:p,zeonBarClass:o,availableZeonClass:d,modifyRzeon:async g=>{g>0?await t.addZeon(g):await t.spendZeon(Math.abs(g))},updateMaxZeon:async()=>{a.value>=0&&a.value!==t.zeon&&await t.updateCharacteristics({zeon:a.value})},toggleAccumulation:async()=>{await t.updateCharacteristics({acu:s.value})},addZeonAccumulated:async g=>{const M=l.value;M>0&&g==="lost"&&(await t.addZeonAccumulated(M,g),l.value=0)}}}},Te={class:"card mb-3"},Ce={class:"card-body"},we={class:"row g-3"},Me={class:"col-12"},ke={class:"progress",style:{height:"30px"}},xe={class:"col-12"},Ze={class:"col-12"},Ae={class:"form-check"},$e={class:"col-md-6"},Re={class:"col-md-6"},Ie={class:"input-group"};function Ee(t,e,l,a,s,p){return h(),m("div",Te,[e[12]||(e[12]=n("div",{class:"card-header"},[n("h5",{class:"mb-0"},"Control de Zeon")],-1)),n("div",Ce,[n("div",we,[n("div",Me,[e[7]||(e[7]=n("label",{class:"form-label"},"Reserva de Zeon",-1)),n("div",ke,[n("div",{class:H(["progress-bar",a.zeonBarClass]),role:"progressbar",style:K({width:a.zeonPercentage+"%"})},f(a.gameState.rzeon)+" / "+f(a.gameState.zeon),7)])]),n("div",xe,[e[8]||(e[8]=n("label",{for:"zeon-control-max-zeon",class:"form-label"},"Zeon Máximo",-1)),v(n("input",{id:"zeon-control-max-zeon",type:"number",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=o=>a.maxZeon=o),onBlur:e[1]||(e[1]=(...o)=>a.updateMaxZeon&&a.updateMaxZeon(...o)),onKeyup:e[2]||(e[2]=G((...o)=>a.updateMaxZeon&&a.updateMaxZeon(...o),["enter"])),min:"0"},null,544),[[z,a.maxZeon,void 0,{number:!0}]])]),n("div",Ze,[n("div",Ae,[v(n("input",{id:"zeon-control-accumulate-checkbox",type:"checkbox",class:"form-check-input","onUpdate:modelValue":e[3]||(e[3]=o=>a.acuCheckbox=o),onChange:e[4]||(e[4]=(...o)=>a.toggleAccumulation&&a.toggleAccumulation(...o))},null,544),[[j,a.acuCheckbox]]),e[9]||(e[9]=n("label",{for:"zeon-control-accumulate-checkbox",class:"form-check-label"}," Acumular Zeon ",-1))])]),n("div",$e,[e[10]||(e[10]=n("label",{for:"zeon-control-accumulated",class:"form-label"},"Zeon Acumulado (Normal)",-1)),v(n("input",{id:"zeon-control-accumulated",type:"number",class:"form-control","onUpdate:modelValue":e[5]||(e[5]=o=>a.gameState.zeona=o),readonly:""},null,512),[[z,a.gameState.zeona,void 0,{number:!0}]])]),n("div",Re,[e[11]||(e[11]=n("label",{for:"zeon-control-lost",class:"form-label"},"Zeon Perdido",-1)),n("div",Ie,[v(n("input",{id:"zeon-control-lost",type:"number",class:"form-control","onUpdate:modelValue":e[6]||(e[6]=o=>a.zeonLostAmount=o),min:"0"},null,512),[[z,a.zeonLostAmount,void 0,{number:!0}]])])])])])])}const De=k(Se,[["render",Ee]]),Le={name:"SpellForm",setup(){const t=L(),e=S({spell_name:"",spell_via:"",spell_base:0,spell_inter:0,spell_advanced:0,spell_arcane:0,spell_base_mantain:0,spell_inter_mantain:0,spell_advanced_mantain:0,spell_arcane_mantain:0});return{formData:e,handleAddSpell:async()=>{if(!(!e.value.spell_name||e.value.spell_name.trim()==="")&&!(typeof e.value.spell_base!="number"||typeof e.value.spell_inter!="number"||typeof e.value.spell_advanced!="number"||typeof e.value.spell_arcane!="number"))try{await t.addSpell(e.value),e.value={spell_name:"",spell_via:"",spell_base:0,spell_inter:0,spell_advanced:0,spell_arcane:0,spell_base_mantain:0,spell_inter_mantain:0,spell_advanced_mantain:0,spell_arcane_mantain:0}}catch(a){console.error("Error añadiendo hechizo:",a)}}}}},Ve={class:"spell-form-container"},Be={class:"form-row"},Ue={class:"form-group"},Pe={class:"form-group"},Ne={class:"form-row"},Ge={class:"form-group"},He={class:"form-group"},je={class:"form-group"},Fe={class:"form-group"},qe={class:"form-row"},Ke={class:"form-group"},Oe={class:"form-group"},We={class:"form-group"},Je={class:"form-group"};function Qe(t,e,l,a,s,p){return h(),m("div",Ve,[e[22]||(e[22]=n("h3",null,"Añadir Hechizo",-1)),n("form",{onSubmit:e[10]||(e[10]=O((...o)=>a.handleAddSpell&&a.handleAddSpell(...o),["prevent"])),class:"spell-form"},[n("div",Be,[n("div",Ue,[e[11]||(e[11]=n("label",{for:"spellName"},"Nombre:",-1)),v(n("input",{type:"text",id:"spellName","onUpdate:modelValue":e[0]||(e[0]=o=>a.formData.spell_name=o),placeholder:"Nombre del hechizo",required:""},null,512),[[z,a.formData.spell_name]])]),n("div",Pe,[e[12]||(e[12]=n("label",{for:"spellVia"},"Vía:",-1)),v(n("input",{type:"text",id:"spellVia","onUpdate:modelValue":e[1]||(e[1]=o=>a.formData.spell_via=o),placeholder:"Vía mágica"},null,512),[[z,a.formData.spell_via]])])]),n("div",Ne,[n("div",Ge,[e[13]||(e[13]=n("label",{for:"spellBase"},"Base:",-1)),v(n("input",{type:"number",id:"spellBase","onUpdate:modelValue":e[2]||(e[2]=o=>a.formData.spell_base=o),placeholder:"0",required:""},null,512),[[z,a.formData.spell_base,void 0,{number:!0}]])]),n("div",He,[e[14]||(e[14]=n("label",{for:"spellInter"},"Intermedio:",-1)),v(n("input",{type:"number",id:"spellInter","onUpdate:modelValue":e[3]||(e[3]=o=>a.formData.spell_inter=o),placeholder:"0",required:""},null,512),[[z,a.formData.spell_inter,void 0,{number:!0}]])]),n("div",je,[e[15]||(e[15]=n("label",{for:"spellAdvanced"},"Avanzado:",-1)),v(n("input",{type:"number",id:"spellAdvanced","onUpdate:modelValue":e[4]||(e[4]=o=>a.formData.spell_advanced=o),placeholder:"0",required:""},null,512),[[z,a.formData.spell_advanced,void 0,{number:!0}]])]),n("div",Fe,[e[16]||(e[16]=n("label",{for:"spellArcane"},"Arcano:",-1)),v(n("input",{type:"number",id:"spellArcane","onUpdate:modelValue":e[5]||(e[5]=o=>a.formData.spell_arcane=o),placeholder:"0",required:""},null,512),[[z,a.formData.spell_arcane,void 0,{number:!0}]])])]),n("div",qe,[n("div",Ke,[e[17]||(e[17]=n("label",{for:"spellBaseMantain"},"Mantener Base:",-1)),v(n("input",{type:"number",id:"spellBaseMantain","onUpdate:modelValue":e[6]||(e[6]=o=>a.formData.spell_base_mantain=o),placeholder:"0"},null,512),[[z,a.formData.spell_base_mantain,void 0,{number:!0}]])]),n("div",Oe,[e[18]||(e[18]=n("label",{for:"spellInterMantain"},"Mantener Inter:",-1)),v(n("input",{type:"number",id:"spellInterMantain","onUpdate:modelValue":e[7]||(e[7]=o=>a.formData.spell_inter_mantain=o),placeholder:"0"},null,512),[[z,a.formData.spell_inter_mantain,void 0,{number:!0}]])]),n("div",We,[e[19]||(e[19]=n("label",{for:"spellAdvancedMantain"},"Mantener Avanzado:",-1)),v(n("input",{type:"number",id:"spellAdvancedMantain","onUpdate:modelValue":e[8]||(e[8]=o=>a.formData.spell_advanced_mantain=o),placeholder:"0"},null,512),[[z,a.formData.spell_advanced_mantain,void 0,{number:!0}]])]),n("div",Je,[e[20]||(e[20]=n("label",{for:"spellArcaneMantain"},"Mantener Arcano:",-1)),v(n("input",{type:"number",id:"spellArcaneMantain","onUpdate:modelValue":e[9]||(e[9]=o=>a.formData.spell_arcane_mantain=o),placeholder:"0"},null,512),[[z,a.formData.spell_arcane_mantain,void 0,{number:!0}]])])]),e[21]||(e[21]=n("button",{type:"submit",class:"btn btn-primary"},"Añadir Hechizo",-1))],32)])}const Xe=k(Le,[["render",Qe],["__scopeId","data-v-d31432a5"]]),Ye={name:"SpellBook",setup(){const t=L(),e=R();return{spellsStore:t,handleAddToReadyToCast:async(s,p)=>{var o;try{let d=0,T=0,C="";switch(console.log("🔍 Hechizo completo:",s),console.log("📊 Nivel seleccionado:",p),p){case"base":d=s.spell_base,T=s.spell_base_mantain||0,C="Base";break;case"inter":d=s.spell_inter,T=s.spell_inter_mantain||0,C="Intermedio";break;case"advanced":d=s.spell_advanced,T=s.spell_advanced_mantain||0,C="Avanzado";break;case"arcane":d=s.spell_arcane,T=s.spell_arcane_mantain||0,C="Arcano";break}const x={spell_id:s.id,spell_name:`${s.spell_name} (${C})`,spell_zeon:d,spell_mantain:T,spell_mantain_turn:!1,spell_index:e.readyToCast.length};console.log("📤 Datos a enviar:",x),await e.addToReadyToCast(x),console.log(`✅ ${s.spell_name} (${C}) añadido a hechizos a lanzar`)}catch(d){console.error("❌ Error completo:",d),console.error("❌ Respuesta del servidor:",(o=d.response)==null?void 0:o.data)}},handleRemoveSpell:async s=>{if(confirm(`¿Eliminar el hechizo "${s}"?`))try{await t.removeSpell(s)}catch(p){console.error("Error eliminando hechizo:",p)}}}}},en={class:"spell-book-container"},nn={key:0,class:"empty-state"},an={key:1,class:"table-responsive"},tn={class:"table"},on=["onClick","title"],ln=["onClick","title"],sn=["onClick","title"],rn=["onClick","title"],dn=["onClick"];function cn(t,e,l,a,s,p){return h(),m("div",en,[e[1]||(e[1]=n("h3",null,"Lista de Hechizos",-1)),a.spellsStore.spellBook.length===0?(h(),m("div",nn," No hay hechizos guardados. Añade uno nuevo arriba. ")):(h(),m("div",an,[n("table",tn,[e[0]||(e[0]=n("thead",null,[n("tr",null,[n("th",null,"Nombre"),n("th",null,"Vía"),n("th",null,"Base"),n("th",null,"Mant Base"),n("th",null,"Inter"),n("th",null,"Mant Inter"),n("th",null,"Avanz"),n("th",null,"Mant Avanz"),n("th",null,"Arcano"),n("th",null,"Mant Arcano"),n("th",null,"Acciones")])],-1)),n("tbody",null,[(h(!0),m(B,null,U(a.spellsStore.spellBook,o=>(h(),m("tr",{key:o.id},[n("td",null,f(o.spell_name),1),n("td",null,f(o.spell_via||"-"),1),n("td",null,[n("button",{onClick:d=>a.handleAddToReadyToCast(o,"base"),class:"btn btn-zeon btn-sm",title:`Preparar ${o.spell_name} (Base)`},f(o.spell_base),9,on)]),n("td",null,f(o.spell_base_mantain||"-"),1),n("td",null,[n("button",{onClick:d=>a.handleAddToReadyToCast(o,"inter"),class:"btn btn-zeon btn-sm",title:`Preparar ${o.spell_name} (Intermedio)`},f(o.spell_inter),9,ln)]),n("td",null,f(o.spell_inter_mantain||"-"),1),n("td",null,[n("button",{onClick:d=>a.handleAddToReadyToCast(o,"advanced"),class:"btn btn-zeon btn-sm",title:`Preparar ${o.spell_name} (Avanzado)`},f(o.spell_advanced),9,sn)]),n("td",null,f(o.spell_advanced_mantain||"-"),1),n("td",null,[n("button",{onClick:d=>a.handleAddToReadyToCast(o,"arcane"),class:"btn btn-zeon btn-sm",title:`Preparar ${o.spell_name} (Arcano)`},f(o.spell_arcane),9,rn)]),n("td",null,f(o.spell_arcane_mantain||"-"),1),n("td",null,[n("button",{onClick:d=>a.handleRemoveSpell(o.spell_name),class:"btn btn-danger btn-sm"}," Eliminar ",8,dn)])]))),128))])])]))])}const un=k(Ye,[["render",cn],["__scopeId","data-v-188e7892"]]),pn={name:"ReadyToCast",setup(){const t=R(),e=S(""),l=S(0),a=S(0);return{gameState:t,loadSpellName:e,loadSpellZeon:l,loadSpellMantain:a,handleLoadSpell:async()=>{if(!(!e.value||!l.value))try{await t.addToReadyToCast({spell_id:null,spell_name:e.value,spell_zeon:l.value,spell_mantain:a.value,spell_mantain_turn:!1,spell_index:t.readyToCast.length}),e.value="",l.value=0,a.value=0}catch(d){console.error("Error cargando hechizo:",d)}},handleUnloadSpell:async d=>{try{await t.removeFromReadyToCast(d)}catch(T){console.error("Error descargando hechizo:",T)}},handleCastSpell:async()=>{try{await t.clearAllReadyToCast()}catch(d){console.error("Error lanzando hechizos:",d)}}}}},mn={class:"ready-to-cast-container"},hn={class:"load-spell-form"},_n={class:"form-row"},fn={key:0,class:"empty-state"},bn={key:1,class:"table-responsive"},vn={class:"table"},yn=["onUpdate:modelValue","disabled"],zn=["onClick"],gn={class:"total-zeon"};function Sn(t,e,l,a,s,p){return h(),m("div",mn,[e[6]||(e[6]=n("h3",null,"Hechizos a Lanzar",-1)),n("div",hn,[n("div",_n,[v(n("input",{id:"ready-to-cast-spell-name",type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>a.loadSpellName=o),placeholder:"Nombre del hechizo",class:"form-control"},null,512),[[z,a.loadSpellName]]),v(n("input",{id:"ready-to-cast-spell-zeon",type:"number","onUpdate:modelValue":e[1]||(e[1]=o=>a.loadSpellZeon=o),placeholder:"Zeon",class:"form-control"},null,512),[[z,a.loadSpellZeon,void 0,{number:!0}]]),v(n("input",{id:"ready-to-cast-spell-mantain",type:"number","onUpdate:modelValue":e[2]||(e[2]=o=>a.loadSpellMantain=o),placeholder:"Mantener",class:"form-control"},null,512),[[z,a.loadSpellMantain,void 0,{number:!0}]]),n("button",{onClick:e[3]||(e[3]=(...o)=>a.handleLoadSpell&&a.handleLoadSpell(...o)),class:"btn btn-success"}," Cargar ")])]),a.gameState.readyToCast.length===0?(h(),m("div",fn," No hay hechizos cargados para lanzar. ")):(h(),m("div",bn,[n("table",vn,[e[5]||(e[5]=n("thead",null,[n("tr",null,[n("th",null,"Nombre"),n("th",null,"Zeon"),n("th",null,"Mantener"),n("th",null,"Mant. este turno"),n("th",null,"Acciones")])],-1)),n("tbody",null,[(h(!0),m(B,null,U(a.gameState.readyToCast,o=>(h(),m("tr",{key:o.id},[n("td",null,f(o.spell_name),1),n("td",null,f(o.spell_zeon),1),n("td",null,f(o.spell_mantain||0),1),n("td",null,[v(n("input",{type:"checkbox","onUpdate:modelValue":d=>o.spell_mantain_turn=d,disabled:!o.spell_mantain||o.spell_mantain===0},null,8,yn),[[j,o.spell_mantain_turn]])]),n("td",null,[n("button",{onClick:d=>a.handleUnloadSpell(o.id),class:"btn btn-warning btn-sm"}," Descargar ",8,zn)])]))),128))])]),n("div",gn,[n("strong",null,"Zeon Total a Gastar: "+f(a.gameState.zeonToSpend),1)]),n("button",{onClick:e[4]||(e[4]=(...o)=>a.handleCastSpell&&a.handleCastSpell(...o)),class:"btn btn-primary btn-cast"}," Lanzar Hechizos ")]))])}const Tn=k(pn,[["render",Sn],["__scopeId","data-v-be671c32"]]),Cn={name:"MaintainedSpells",setup(){const t=L();return{spellsStore:t,handleUnmantainSpell:async l=>{if(confirm("¿Dejar de mantener este hechizo?"))try{await t.unmantainSpell(l)}catch(a){console.error("Error eliminando mantenimiento:",a)}}}}},wn={class:"maintained-spells-container"},Mn={key:0,class:"empty-state"},kn={key:1,class:"table-responsive"},xn={class:"table"},Zn=["onClick"],An={class:"total-mantain"};function $n(t,e,l,a,s,p){return h(),m("div",wn,[e[1]||(e[1]=n("h3",null,"Hechizos Mantenidos",-1)),a.spellsStore.spellMantainList.length===0?(h(),m("div",Mn," No hay hechizos mantenidos actualmente. ")):(h(),m("div",kn,[n("table",xn,[e[0]||(e[0]=n("thead",null,[n("tr",null,[n("th",null,"Nombre"),n("th",null,"Coste de Mantenimiento"),n("th",null,"Acciones")])],-1)),n("tbody",null,[(h(!0),m(B,null,U(a.spellsStore.spellMantainList,o=>(h(),m("tr",{key:o.spell_index},[n("td",null,f(o.spell_name||o.spellName),1),n("td",null,f(o.spell_mantain||o.spellMantain),1),n("td",null,[n("button",{onClick:d=>a.handleUnmantainSpell(o.spell_index),class:"btn btn-danger btn-sm"}," Eliminar ",8,Zn)])]))),128))])]),n("div",An,[n("strong",null,"Zeon Total de Mantenimiento: "+f(a.spellsStore.mantainZeonToSpend),1)])]))])}const Rn=k(Cn,[["render",$n],["__scopeId","data-v-264e16b5"]]),In={name:"Home",components:{TurnCounter:re,CharacterStats:ge,ZeonControl:De,SpellForm:Xe,SpellBook:un,ReadyToCast:Tn,MaintainedSpells:Rn},setup(){const t=J(),e=y(),l=R(),a=L(),s=S(!1);return W(async()=>{const d=localStorage.getItem("theme");s.value=d==="dark",s.value&&document.body.classList.add("dark-mode"),await l.loadGameData(),await a.fetchSpellBook(),await a.fetchReadyToCast(),await a.fetchMaintainedSpells()}),{authStore:e,gameState:l,isDarkMode:s,toggleTheme:()=>{s.value=!s.value,document.body.classList.toggle("dark-mode"),localStorage.setItem("theme",s.value?"dark":"light")},handleLogout:async()=>{l.resetState(),a.resetSpellData(),e.logout(),t.push("/login")}}}},En={class:"header-fixed"},Dn={class:"d-flex justify-content-between align-items-center gap-3"},Ln={class:"d-flex gap-2"},Vn={class:"container-fluid main-content"},Bn={key:0,class:"text-center py-5"},Un={key:1,class:"alert alert-danger",role:"alert"},Pn={key:2,class:"row"},Nn={class:"col-lg-4"},Gn={class:"col-lg-4"},Hn={class:"col-lg-12"};function jn(t,e,l,a,s,p){const o=$("TurnCounter"),d=$("CharacterStats"),T=$("ZeonControl"),C=$("SpellForm"),x=$("SpellBook"),E=$("ReadyToCast"),g=$("MaintainedSpells");return h(),m("div",null,[n("header",En,[n("div",Dn,[e[3]||(e[3]=n("div",null,[n("h5",{class:"mb-0"},"Anima Counter")],-1)),n("div",Ln,[n("button",{class:"btn btn-outline-secondary",onClick:e[0]||(e[0]=(...M)=>a.toggleTheme&&a.toggleTheme(...M)),title:"Cambiar tema"},[n("i",{class:H(a.isDarkMode?"bi bi-sun":"bi bi-moon")},null,2)]),n("button",{class:"btn btn-danger",onClick:e[1]||(e[1]=(...M)=>a.handleLogout&&a.handleLogout(...M)),title:"Cerrar Sesión"},[...e[2]||(e[2]=[n("i",{class:"bi bi-box-arrow-right"},null,-1)])])])])]),n("div",Vn,[a.gameState.loading?(h(),m("div",Bn,[...e[4]||(e[4]=[n("div",{class:"spinner-border text-primary",role:"status"},[n("span",{class:"visually-hidden"},"Cargando...")],-1)])])):D("",!0),a.gameState.error?(h(),m("div",Un,f(a.gameState.error),1)):D("",!0),a.gameState.loading?D("",!0):(h(),m("div",Pn,[n("div",Nn,[A(o),A(d)]),n("div",Gn,[A(T)]),n("div",Hn,[A(C),A(x),A(E),A(g)])]))])])}const qn=k(In,[["render",jn],["__scopeId","data-v-df457045"]]);export{qn as default};
